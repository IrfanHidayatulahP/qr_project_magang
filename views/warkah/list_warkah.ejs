<%- include('../partials/header.ejs') %>

<div id="konten-warkah" style="display: none;">
    <section class="container-fluid">
        
        <div class="header-action">
            <h1 class="page-title">Daftar Warkah</h1>
            <div style="display:flex; gap:10px;">
                <a class="btn-add" href="/warkah/create"><i class="fas fa-plus"></i> Tambah Warkah</a>
                <button id="btn-open-download" class="btn-add" type="button"><i class="fas fa-download"></i> Download</button>
            </div>
        </div>

        <% if (typeof error !=='undefined' && error) { %> <div class="alert alert-error"><%= error %></div> <% } %>
        <% if (typeof success !=='undefined' && success) { %> <div class="alert alert-success"><%= success %></div> <% } %>

        <form method="get" action="/warkah" class="search-form">
            <input type="text" name="q" placeholder="Cari ID / No DI-208 / No Hak..." value="<%= (typeof filter_q !== 'undefined') ? filter_q : '' %>" />
            <button type="submit"><i class="fas fa-search"></i> Cari</button>
        </form>

        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nomor DI-208</th>
                        <th>Nomor Hak</th>
                        <th>Tahun</th>
                        <th>Media</th>
                        <th>Jumlah</th>
                        <th>Lokasi</th>
                        <th>No Boks</th>
                        <th>QR</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (typeof records !=='undefined' && records && records.length) { %>
                        <% records.forEach(r => { %>
                            <tr data-id="<%= r.id_warkah %>">
                                <td><%= r.id_warkah %></td>
                                <td><%= r.nomor_di_208 || '-' %></td>
                                <td><%= r.nomor_hak || '-' %></td>
                                <td>
                                    <% 
                                        let yearDisplay = '-'; 
                                        if (r.tahun_terbit) {
                                            const tv = r.tahun_terbit;
                                            if (tv instanceof Date) { yearDisplay = tv.getFullYear(); }
                                            else { 
                                                const s = String(tv).trim(); 
                                                yearDisplay = /^\d{4}/.test(s) ? s.match(/^\d{4}/)[0] : new Date(s).getFullYear();
                                                if (isNaN(yearDisplay)) yearDisplay = '-';
                                            }
                                        } 
                                    %>
                                    <%= yearDisplay %>
                                </td>
                                <td><%= r.media || '-' %></td>
                                <td><%= (r.jumlah != null) ? r.jumlah : '-' %></td>
                                <td><%= r.lokasi_penyimpanan || '-' %></td>
                                <td><%= r.no_boks_definitif || '-' %></td>
                                
                                <td style="text-align:center;">
                                    <div class="qr-preview">
                                        <a href="/warkah/detail/<%= r.id_warkah %>">
                                            <img src="/warkah/<%= r.id_warkah %>/qr.png" alt="QR" />
                                        </a>
                                    </div>
                                </td>
                                
                                <td class="action-links">
                                    <a href="/warkah/<%= r.id_warkah %>" class="link-detail" title="Lihat"><i class="fas fa-eye"></i></a>
                                    
                                    <a href="/warkah/edit/<%= r.id_warkah %>" class="link-edit" title="Edit"><i class="fas fa-edit"></i></a>
                                    <form action="/warkah/delete/<%= r.id_warkah %>" method="post" style="display:inline" onsubmit="return confirm('Hapus data warkah ini?');">
                                        <button type="submit" class="btn-delete" title="Hapus"><i class="fas fa-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="10" style="text-align:center; padding:20px; color:#6b7280;">
                                Belum ada data warkah.
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <div id="source-checkboxes" style="display:none;">
            <label><input type="checkbox" name="col" value="id_warkah" checked> ID</label>
            <label><input type="checkbox" name="col" value="nomor_di_208" checked> Nomor DI-208</label>
            <label><input type="checkbox" name="col" value="nomor_hak" checked> Nomor Hak</label>
            <label><input type="checkbox" name="col" value="tahun_terbit" checked> Tahun</label>
            <label><input type="checkbox" name="col" value="kode_klasifikasi" checked> Kode Klasifikasi</label>
            <label><input type="checkbox" name="col" value="jenis_arsip_vital" checked> Jenis Arsip Vital</label>
            <label style="width:100%;"><input type="checkbox" name="col" value="uraian_informasi_arsip" checked> Uraian Informasi</label>
            <label><input type="checkbox" name="col" value="media" checked> Media</label>
            <label><input type="checkbox" name="col" value="jumlah" checked> Jumlah</label>
            <label><input type="checkbox" name="col" value="jangka_simpan_aktif" checked> Jangka Simpan Aktif</label>
            <label><input type="checkbox" name="col" value="jangka_simpan_inaktif" checked> Jangka Simpan Inaktif</label>
            <label><input type="checkbox" name="col" value="jangka_simpan_keterangan" checked> Ket. Jangka Simpan</label>
            <label><input type="checkbox" name="col" value="tingkat_perkembangan" checked> Perkembangan</label>
            <label><input type="checkbox" name="col" value="lokasi_penyimpanan" checked> Lokasi</label>
            <label><input type="checkbox" name="col" value="no_boks_definitif" checked> No Boks</label>
            <label><input type="checkbox" name="col" value="nomor_folder" checked> No Folder</label>
            <label><input type="checkbox" name="col" value="metode_perlindungan" checked> Metode Proteksi</label>
            <label style="width:100%;"><input type="checkbox" name="col" value="keterangan" checked> Keterangan</label>
        </div>

    </section>
</div>

<%- include('../partials/list_template.ejs', { 
    baseUrl: '/warkah', 
    contentId: 'konten-warkah' 
}) %>