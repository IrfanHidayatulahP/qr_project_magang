<%- include('../partials/header.ejs') %>

<main class="main-content">

    <div class="container-fluid p-4">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h4 class="fw-bold text-dark mb-1">Detail Lengkap Arsip</h4>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 small text-muted">
                        <li class="breadcrumb-item"><a href="/dashboard" class="text-decoration-none">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="/daftar-arsip" class="text-decoration-none">Daftar Arsip</a></li>
                        <li class="breadcrumb-item active">Detail #<%= data.id_daftar_arsip %></li>
                    </ol>
                </nav>
            </div>
            <div>
                <!-- DESKTOP -->
                <a href="/daftar-arsip" 
                class="btn btn-outline-secondary btn-sm d-none d-md-inline-flex">
                    <i class="fas fa-arrow-left me-2"></i>Kembali
                </a>

                <!-- MOBILE -->
                <a href="/daftar-arsip" 
                class="d-inline d-md-none text-secondary fs-4">
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
        </div>

        <div class="card shadow-sm border-0 mb-5 bg-white rounded-3">
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-2 text-center border-end">
                        <span class="d-block text-muted small text-uppercase fw-bold mb-2">Nomor Urut</span>
                        <h1 class="display-4 fw-bold text-primary mb-0"><%= data.nomor_urut %></h1>
                    </div>
                    <div class="col-md-10 ps-md-4">
                        <h4 class="fw-bold text-dark mb-2"><%= data.nomor_hak || 'Tanpa Nomor Hak' %></h4>
                        
                        <div class="d-flex gap-3 mb-3 flex-wrap">
                            <span class="badge bg-light text-dark border px-3 py-2">
                                <i class="fas fa-tag me-2 text-muted"></i>Klasifikasi: <%= data.kode_klasifikasi || '-' %>
                            </span>
                            <span class="badge bg-light text-dark border px-3 py-2">
                                <i class="fas fa-calendar-alt me-2 text-muted"></i>Kurun Waktu: <%= data.kurun_waktu_berkas || '-' %>
                            </span>
                            <span class="badge bg-light text-dark border px-3 py-2">
                                <i class="fas fa-layer-group me-2 text-muted"></i>Jenis: <%= data.jenis_arsip_vital || '-' %>
                            </span>
                        </div>

                        <div class="bg-light p-3 rounded border-start border-4 border-secondary">
                            <label class="small text-muted fw-bold mb-1">Uraian / Item Arsip:</label>
                            <p class="mb-0 text-dark"><%= data.nomor_item_arsip_uraian || '-' %></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            
            <div class="col-lg-4">
                <div class="card h-100 shadow-sm border-0" style="border-top: 4px solid #0d6efd !important;">
                    <div class="card-header bg-white py-3">
                        <h6 class="fw-bold text-primary mb-0"><i class="fas fa-book me-2"></i>Buku Tanah</h6>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <% if(data.id_dokumen_bt) { %>
                            <ul class="list-group list-group-flush small mb-3">
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Nomor Hak</span>
                                    <span class="fw-bold"><%= data.bt_nomor_hak %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Jenis Hak</span>
                                    <span><%= data.bt_jenis_hak || '-' %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Tahun</span>
                                    <span><%= data.bt_tahun ? new Date(data.bt_tahun).getFullYear() : '-' %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Fisik</span>
                                    <span><%= data.bt_media %> (<%= data.bt_jumlah %> lbr)</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Lokasi</span>
                                    <span class="text-end"><%= data.bt_lokasi %><br><span class="text-muted" style="font-size:10px">Boks: <%= data.bt_boks %></span></span>
                                </li>
                                
                                <li class="list-group-item px-0">
                                    <span class="text-muted d-block mb-1" style="font-size: 0.85rem;">File Digital:</span>
                                    <% 
                                        let btFiles = []; 
                                        try { btFiles = JSON.parse(data.bt_files); } catch(e){} 
                                    %>
                                    <% if(btFiles.length > 0) { %>
                                        <div class="d-flex flex-column gap-1">
                                            <% btFiles.forEach(f => { %>
                                                <a href="/<%= f %>" target="_blank" class="text-decoration-none small text-truncate" style="max-width: 100%;">
                                                    <i class="fas fa-file-pdf text-danger me-1"></i> <%= f.split('/').pop() %>
                                                </a>
                                            <% }) %>
                                        </div>
                                    <% } else { %>
                                        <span class="text-muted small">- Tidak ada file -</span>
                                    <% } %>
                                </li>

                            </ul>
                            <div class="mt-auto text-center">
                                <a href="/buku-tanah/<%= data.id_dokumen_bt %>" class="btn btn-sm btn-outline-primary w-100">
                                    <i class="fas fa-external-link-alt me-1"></i> Lihat & Edit Sumber Asli
                                </a>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5 text-muted flex-grow-1 d-flex flex-column justify-content-center align-items-center">
                                <div class="mb-3 p-3 bg-primary bg-opacity-10 rounded-circle">
                                    <i class="fas fa-book fa-2x text-primary"></i>
                                </div>
                                <p class="mb-3 small">Data Buku Tanah belum terhubung.</p>
                                <a href="/buku-tanah/create?ref_hak=<%= encodeURIComponent(data.nomor_hak || '') %>" class="btn btn-sm btn-primary fw-bold px-4 shadow-sm">
                                    <i class="fas fa-plus-circle me-1"></i> Tambah Buku Tanah
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card h-100 shadow-sm border-0" style="border-top: 4px solid #198754 !important;">
                    <div class="card-header bg-white py-3">
                        <h6 class="fw-bold text-success mb-0"><i class="fas fa-ruler-combined me-2"></i>Surat Ukur</h6>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <% if(data.id_dokumen_su) { %>
                            <ul class="list-group list-group-flush small mb-3">
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">No Surat Ukur</span>
                                    <span class="fw-bold"><%= data.su_nomor %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">No Hak Terkait</span>
                                    <span><%= data.su_nomor_hak || '-' %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Tahun</span>
                                    <span><%= data.su_tahun ? new Date(data.su_tahun).getFullYear() : '-' %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Fisik</span>
                                    <span><%= data.su_media %> (<%= data.su_jumlah %> lbr)</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Lokasi</span>
                                    <span class="text-end"><%= data.su_lokasi %><br><span class="text-muted" style="font-size:10px">Boks: <%= data.su_boks %></span></span>
                                </li>

                                <li class="list-group-item px-0">
                                    <span class="text-muted d-block mb-1" style="font-size: 0.85rem;">File Digital:</span>
                                    <% 
                                        let suFiles = []; 
                                        try { suFiles = JSON.parse(data.su_files); } catch(e){} 
                                    %>
                                    <% if(suFiles.length > 0) { %>
                                        <div class="d-flex flex-column gap-1">
                                            <% suFiles.forEach(f => { %>
                                                <a href="/<%= f %>" target="_blank" class="text-decoration-none small text-truncate" style="max-width: 100%;">
                                                    <i class="fas fa-file-pdf text-danger me-1"></i> <%= f.split('/').pop() %>
                                                </a>
                                            <% }) %>
                                        </div>
                                    <% } else { %>
                                        <span class="text-muted small">- Tidak ada file -</span>
                                    <% } %>
                                </li>

                            </ul>
                            <div class="mt-auto text-center">
                                <a href="/surat-ukur/<%= data.id_dokumen_su %>" class="btn btn-sm btn-outline-success w-100">
                                    <i class="fas fa-external-link-alt me-1"></i> Lihat & Edit Sumber Asli
                                </a>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5 text-muted flex-grow-1 d-flex flex-column justify-content-center align-items-center">
                                <div class="mb-3 p-3 bg-success bg-opacity-10 rounded-circle">
                                    <i class="fas fa-ruler-combined fa-2x text-success"></i>
                                </div>
                                <p class="mb-3 small">Data Surat Ukur belum terhubung.</p>
                                <a href="/surat-ukur/create?ref_hak=<%= encodeURIComponent(data.nomor_hak || '') %>" class="btn btn-sm btn-success fw-bold px-4 shadow-sm">
                                    <i class="fas fa-plus-circle me-1"></i> Tambah Surat Ukur
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card h-100 shadow-sm border-0" style="border-top: 4px solid #ffc107 !important;">
                    <div class="card-header bg-white py-3">
                        <h6 class="fw-bold text-warning text-dark mb-0"><i class="fas fa-file-archive me-2"></i>Warkah</h6>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <% if(data.id_dokumen_warkah) { %>
                            <ul class="list-group list-group-flush small mb-3">
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">No DI 208</span>
                                    <span class="fw-bold"><%= data.w_nomor %></span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">No Hak Terkait</span>
                                    <span><%= data.w_nomor_hak || '-' %></span>
                                </li>
                                <li class="list-group-item px-0">
                                    <span class="text-muted d-block mb-1">Uraian Warkah:</span>
                                    <div class="bg-light p-2 rounded" style="font-size:11px; max-height:60px; overflow-y:auto;">
                                        <%= data.w_uraian || '-' %>
                                    </div>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Fisik</span>
                                    <span><%= data.w_media %> (<%= data.w_jumlah %> lbr)</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between px-0">
                                    <span class="text-muted">Lokasi</span>
                                    <span class="text-end"><%= data.w_lokasi %><br><span class="text-muted" style="font-size:10px">Boks: <%= data.w_boks %></span></span>
                                </li>

                                <li class="list-group-item px-0">
                                    <span class="text-muted d-block mb-1" style="font-size: 0.85rem;">File Digital:</span>
                                    <% 
                                        let wFiles = []; 
                                        try { wFiles = JSON.parse(data.w_files); } catch(e){} 
                                    %>
                                    <% if(wFiles.length > 0) { %>
                                        <div class="d-flex flex-column gap-1">
                                            <% wFiles.forEach(f => { %>
                                                <a href="/<%= f %>" target="_blank" class="text-decoration-none small text-truncate" style="max-width: 100%;">
                                                    <i class="fas fa-file-pdf text-danger me-1"></i> <%= f.split('/').pop() %>
                                                </a>
                                            <% }) %>
                                        </div>
                                    <% } else { %>
                                        <span class="text-muted small">- Tidak ada file -</span>
                                    <% } %>
                                </li>

                            </ul>
                            <div class="mt-auto text-center">
                                <a href="/warkah/<%= data.id_dokumen_warkah %>" class="btn btn-sm btn-outline-warning text-dark w-100">
                                    <i class="fas fa-external-link-alt me-1"></i> Lihat & Edit Sumber Asli
                                </a>
                            </div>
                        <% } else { %>
                            <div class="text-center py-5 text-muted flex-grow-1 d-flex flex-column justify-content-center align-items-center">
                                <div class="mb-3 p-3 bg-warning bg-opacity-10 rounded-circle">
                                    <i class="fas fa-file-archive fa-2x text-warning"></i>
                                </div>
                                <p class="mb-3 small">Data Warkah belum terhubung.</p>
                                <a href="/warkah/create?ref_hak=<%= encodeURIComponent(data.nomor_hak || '') %>" class="btn btn-sm btn-warning text-dark fw-bold px-4 shadow-sm">
                                    <i class="fas fa-plus-circle me-1"></i> Tambah Warkah
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

        </div>

    </div>

</main> 
<%- include('../partials/footer.ejs') %>