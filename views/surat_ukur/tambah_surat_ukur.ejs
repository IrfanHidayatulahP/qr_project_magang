<%- include('../partials/header.ejs') %>

<div id="form-content-surat-ukur" style="display: none;">
    
    <h6 class="text-secondary fw-bold text-uppercase small mb-3 letter-spacing-1 border-bottom pb-2">
        <i class="fas fa-info-circle me-2"></i>Identitas Dokumen
    </h6>
    
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label for="nomor_hak" class="form-label fw-semibold text-dark small">Nomor Hak <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="fas fa-hashtag text-muted"></i></span>
                <input type="text" class="form-control border-start-0 ps-0" name="nomor_hak" id="nomor_hak" 
                       placeholder="Contoh: 00123" 
                       value="<%= (typeof old !== 'undefined' && old.nomor_hak) ? old.nomor_hak : '' %>" required>
            </div>
            <div class="form-text small">Nomor ini harus unik.</div>
        </div>

        <div class="col-md-6">
            <label for="jenis_hak" class="form-label fw-semibold text-dark small">Jenis Hak</label>
            <select class="form-select" name="jenis_hak" id="jenis_hak">
                <option value="">-- Pilih Jenis Hak --</option>
                <% const hakOptions=['HM','HGB','HP','HGU','Pengelolaan','Lainnya']; %>
                <% hakOptions.forEach(h=> { %>
                    <option value="<%= h %>" <%= (typeof old !== 'undefined' && old.jenis_hak===h) ? 'selected' : '' %>><%= h %></option>
                <% }) %>
            </select>
        </div>

        <div class="col-md-6">
            <label for="nomor_surat_ukur" class="form-label fw-semibold text-dark small">Nomor Surat Ukur</label>
            <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="fas fa-ruler-horizontal text-muted"></i></span>
                <input type="text" class="form-control border-start-0 ps-0" name="nomor_surat_ukur" id="nomor_surat_ukur"
                       placeholder="Nomor SU"
                       value="<%= (typeof old !== 'undefined' && old.nomor_surat_ukur) ? old.nomor_surat_ukur : '' %>">
            </div>
        </div>

        <div class="col-md-6">
            <label for="tahun_terbit" class="form-label fw-semibold text-dark small">Tahun Terbit</label>
            <input type="date" class="form-control" name="tahun_terbit" id="tahun_terbit"
                   value="<%= (typeof old !== 'undefined' && old.tahun_terbit) ? old.tahun_terbit : '' %>">
        </div>

        <div class="col-md-6">
            <label for="media" class="form-label fw-semibold text-dark small">Media Arsip</label>
            <select class="form-select" name="media" id="media">
                <option value="">-- Pilih Media --</option>
                <% const mediaOptions=['Kertas','Digital','Microfilm']; %>
                <% mediaOptions.forEach(m=> { %>
                    <option value="<%= m %>" <%= (typeof old !== 'undefined' && old.media===m) ? 'selected' : (m==='Kertas' && typeof old === 'undefined' ? 'selected' : '') %>><%= m %></option>
                <% }) %>
            </select>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label for="jumlah" class="form-label fw-semibold text-dark small">Jumlah Lembar/Berkas</label>
            <div class="input-group">
                <input type="number" class="form-control" name="jumlah" id="jumlah" placeholder="0"
                       value="<%= (typeof old !== 'undefined' && old.jumlah != null) ? old.jumlah : '' %>">
                <span class="input-group-text bg-light text-muted">Lembar</span>
            </div>
        </div>
        <div class="col-md-6">
            <label for="tingkat_perkembangan" class="form-label fw-semibold text-dark small">Tingkat Perkembangan</label>
            <select class="form-select" name="tingkat_perkembangan" id="tingkat_perkembangan">
                <option value="">-- Pilih --</option>
                <% const tpk=['Asli','Copy','Salinan']; %>
                <% tpk.forEach(tp=> { %>
                    <option value="<%= tp %>" <%= (typeof old !== 'undefined' && old.tingkat_perkembangan===tp) ? 'selected' : (tp==='Asli' && typeof old === 'undefined' ? 'selected' : '') %>><%= tp %></option>
                <% }) %>
            </select>
        </div>
    </div>

    <div class="bg-light p-4 rounded-3 border border-dashed">
        <h6 class="text-secondary fw-bold text-uppercase small mb-3 letter-spacing-1">
            <i class="fas fa-map-marker-alt me-2"></i>Lokasi Penyimpanan
        </h6>

        <div class="row g-3">
            <div class="col-12">
                <label for="lokasi_penyimpanan" class="form-label fw-semibold text-dark small">Lokasi Rak / Ruangan</label>
                <select class="form-select" name="lokasi_penyimpanan" id="lokasi_penyimpanan">
                    <option value="">-- Pilih Kode Lokasi --</option>
                    <% if (typeof locations !== 'undefined' && Array.isArray(locations) && locations.length > 0) { %>
                        <% locations.forEach(function(loc) { 
                            var label = (loc.kode_lokasi || '') + (loc.ruangan ? (' â€” ' + loc.ruangan) : '') + (loc.no_rak ? (' / Rak ' + loc.no_rak) : '');
                            var isSelected = (typeof old !== 'undefined' && old.lokasi_penyimpanan === loc.kode_lokasi) ? 'selected' : ''; 
                        %>
                            <option value="<%= loc.kode_lokasi %>" <%= isSelected %>><%= label %></option>
                        <% }); %>
                    <% } else { %>
                        <option value="" disabled>Tidak ada data lokasi</option>
                    <% } %>
                </select>
                <div class="form-text text-muted small"><i class="fas fa-info-circle me-1"></i>Pilih kode lokasi rak yang sudah didaftarkan.</div>
            </div>

            <div class="col-md-6">
                <label for="no_boks_definitif" class="form-label fw-semibold text-dark small">No. Boks Definitif</label>
                <input type="text" class="form-control" name="no_boks_definitif" id="no_boks_definitif"
                       value="<%= (typeof old !== 'undefined' && old.no_boks_definitif) ? old.no_boks_definitif : '' %>">
            </div>
            <div class="col-md-6">
                <label for="nomor_folder" class="form-label fw-semibold text-dark small">Nomor Folder</label>
                <input type="number" class="form-control" name="nomor_folder" id="nomor_folder"
                       value="<%= (typeof old !== 'undefined' && old.nomor_folder != null) ? old.nomor_folder : '' %>">
            </div>

            <div class="col-md-6">
                <label for="metode_perlindungan" class="form-label fw-semibold text-dark small">Metode Perlindungan</label>
                <select class="form-select" name="metode_perlindungan">
                    <option value="">-- Pilih --</option>
                    <% const prot=['Vaulting','Cloud','Physical']; %>
                    <% prot.forEach(p=> { %>
                        <option value="<%= p %>" <%= (typeof old !== 'undefined' && old.metode_perlindungan===p) ? 'selected' : (p==='Vaulting' && typeof old === 'undefined' ? 'selected' : '') %>><%= p %></option>
                    <% }) %>
                </select>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/add_template.ejs', { 
    title: 'Tambah Surat Ukur',
    parentName: 'Surat Ukur',
    parentUrl: '/surat-ukur',
    formAction: '/surat-ukur/create',
    icon: 'fas fa-ruler-combined', 
    contentId: 'form-content-surat-ukur' 
}) %>